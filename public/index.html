<!DOCTYPE html>
<html>
<head>
	<title>Magic Page!</title>

	<!-- jQuery -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-rc1/jquery.min.js"></script>
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
	<!-- Icons -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

</head>
<body>

<div class='container'>
	<div class='row'>
		<div class='col s12 center-align'>
			<h1>Magic Articles!</h1>
		</div>
	</div>
	<div class='row'>
		<div class='col s12 center-align'>
			<h5>Content!</h5>
		</div>
	</div>
	<div id='ContentArea'></div>
	<div class='row'>
		<div class='col s2 imgDiv z-depth-1'>
		</div>
		<div class='col s4 z-depth-1 content'>
			<h5>Content!</h5>
		</div>
	
		<div class='col s2 imgDiv z-depth-1'>
		</div>
		<div class='col s4 z-depth-1 content'>
			<h5>Content!</h5>
		</div>
	</div>

	<!-- Modal Structure -->
	<div id="modal1" class="modal bottom-sheet">
		<div class="modal-content">
			<h4>Comments</h4>
			<div id='commentArea'></div>
		</div>
		<div class="modal-footer">
			<a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Close</a>
		</div>
  </div>
	
</div>

<style type="text/css">
	
	.imgDiv {
		height:200px;
		/*width:250px;*/
		background-image: url(http://magic.wizards.com/sites/mtg/files/images/hero/Y5pS8bxiXG_icon.jpg);
		background-position: 50% 0;
		background-size: cover;
		background-repeat: no-repeat;
   		overflow: hidden;
	}

	.content {
		height: auto;
	}

	p {
		margin-top: 2px;
		margin-bottom: 2px;
		/*font-style: italic;*/
	}

	h5 {
		font-weight: bold;
	}

	.author {
		/*font-weight: bold;*/
		font-stretch: condensed;
		color:gray;
	}

</style>


<script type="text/javascript">

	$(document).ready(function(){



	    $('.collapsible').collapsible({
	      	accordion : false // A setting that changes the collapsible behavior to expandable instead of the default accordion style
	    });

		var originURL = document.location.origin;
		$.ajax({url: originURL + '/api', method: 'GET'}).done(function(response){
			console.log(response)

			for (var i = 0; i < response.length; i++) {

				var row = $("<div>")
				row.addClass('row z-depth-1')

				var imgdiv = $('<div>')
				imgdiv.addClass('col s3 imgDiv')
				imgdiv.css('background-image', 'url(' + response[i].imgURL + ')')

				var contentdiv = $("<div>")
				contentdiv.addClass('col s9')

				contentdiv.append('<h5>' + response[i].title + '</h5>')
				contentdiv.append('<p class="author">' + response[i].date + '</p>')
				contentdiv.append('<p class="author">' + response[i].author + '</p>')
				contentdiv.append('<p>' + response[i].description + '</p>')
				contentdiv.append('<a href="'+response[i].link+'" target="_blank">Read more...</a>')
				contentdiv.append('<br><a class="modal-trigger" data-id="'+response[i]._id+'" href="#modal1">'+response[i].comments.length+' Comments</a>')

				row.append(imgdiv)
				row.append(contentdiv)


				$("#ContentArea").append(row)

				$('.modal-trigger').leanModal();


			}

			$('.modal-trigger').click(function(){
				$.ajax({url: originURL + '/api/'+ $(this).attr('data-id'), method: 'GET'}).done(function(res){

					console.log('comments!!!!1')
					console.log(res)

					$('#commentArea').empty()

					for( var i = 0; i < res.comments.length; i++ ){
						$('#commentArea').append(res.comments[i].author)
						$('#commentArea').append(res.comments[i].body)
					}

				})
				// alert($(this).attr('data-id'))
			})
			

		})

	})

</script>

</body>
</html>